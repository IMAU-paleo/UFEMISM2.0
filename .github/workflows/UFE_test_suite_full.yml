# The full UFEMISM Test Suite

name: UFEMISM Test Suite (full)
run-name: ${{ github.actor }} - UFEMISM Test Suite (full)
on: workflow_dispatch

jobs:
  setup_packages:
    runs-on: macos-latest
    steps:

      - name: Step 0
        run: |
          echo Hello world!

      - name: Install packages with homebrew
        run: |
          #brew install gcc     # Not needed on GitHub server, already installed
          brew install open-mpi
          brew install petsc
          brew unlink hdf5-mpi     # To fix the following conflict: "hdf5-mpi: because hdf5-mpi is a variant of hdf5, one can only use one or the other"
          brew install netcdf
          brew install netcdf-fortran

      - name: testerdetest
        run: |
          echo ls -a
          ls -a
          echo ls -a ~
          ls -a ~

    #  - name: Install nix
    #    uses: cachix/install-nix-action@v22

    #  - uses: actions/cache@v2
    #    id: cache_UFEMISM_program
    #    with:
    #      path: ${{ github.workspace }}/result
    #      key: UFEMISM_program
          
    #  - name: Build UFEMISM with nix
    #    run: |
    #      nix build github:IMAU-paleo/UFEMISM2.0/${{github.sha}}?dir=tools/flake

    #  - name: Checkout UFEMISM repository
    #    uses: actions/checkout@v4

    #  - name: testerdetest
    #    run: |
    #      echo ls -a
    #      ls -a
    #      echo ls -a /nix
    #      ls -a /nix
    #      echo ls -a /nix/store
    #      ls -a /nix/store
            
    #  - uses: actions/cache/save@v3
    #    id: cache
    #    with:
    #      path: /nix/store
    #      key: UFEMISM_nix_packages
          
    #  - if: ${{ steps.cache_UFEMISM_nix_packages.outputs.cache-hit != 'true' }}
    #    name: Cache miss! Download and build UFEMISM nix packages
    #    run: |
    #      nix build github:IMAU-paleo/UFEMISM2.0/${{github.sha}}?dir=tools/flake
          
    #  - if: ${{ steps.cache_UFEMISM_nix_packages.outputs.cache-hit == 'true' }}
    #    name: Cache hit! Load UFEMISM nix packages from cache.
    #    run: |
    #      echo ls -a /nix/store
    #      ls -a /nix/store

  compile_UFEMISM:
    needs: setup_packages
    runs-on: macos-latest
    steps:

      - name: Step 0
        run: |
          echo Hello world!

 #     - name: Install nix
 #       uses: cachix/install-nix-action@v22

  #    - uses: actions/cache/restore@v3
  #      id: restore_cache
  #      with:
  #        path: /nix/store
  #        key: UFEMISM_nix_packages

  #    - uses: actions/cache@v2
  #      id: cache_UFEMISM_nix_packages
  #      with:
  #        path: /nix/store
  #        key: UFEMISM_nix_packages
  #      #  continue-on-error: true

   #   - name: check if cache loaded succesfully
   #     run: |
   #       echo ls -a /nix/store
   #       ls -a /nix/store

    #  - name: Install MATLAB
    #    uses: matlab-actions/setup-matlab@v2.2.0

    #  - name: Another MATLAB test
    #    uses: matlab-actions/run-command@v2
    #    with:
    #      command: disp('Hello world!')
